<!DOCTYPE html>
<html>
<head>
	<title>Hello, World! A-Frame VR World!</title>
</head>
	<script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
	<script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.0/dist/aframe-extras.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var socket = io();
		var queueStack = []
			function test() {
				socket.emit('personalTest','this is a test')
			}

			function createBox() {
				socket.emit('newShape',{geometry: "primitive: sphere; radius: 1000;",
    	position:"-10000 1200 -3000",
    	material:"color:#ff0; metalness:0.0; roughness:1.0;",
    	message:"new Object"})
			}

			function goToAr2() {
				socket.emit("ar2", "This is ar2")
			}

			socket.on('toVRDrawing', function(data){
				let newPath = dummy(data)
				newPath = newPath.slice(0, -1)
				console.log('this is newPath', newPath)
				stringIntoQues(newPath)
				console.log('this is your que', queueStack)
				queueStack.forEach(function(element) {
					creatingObjects(element)
				})
				queueStack = []
			})

			function stringIntoQues(string) {
				let splitString = string.split(',')
			  while(splitString.length > 50) {
			    let placeholder = splitString.slice(0, 50)
			    queueStack.push(placeholder.join(','))
			    splitString = splitString.slice(50)
			  }
			  queueStack.push(splitString.join(','))
			}
			function creatingObjects(string) {
				let entity = document.createElement('a-entity')
				entity.setAttribute("tube", {"path": string})
				document.querySelector('a-scene').appendChild(entity)
			}

			function dummy (arr) {
				let results = ''
				arr.forEach(function(element) {
					results = results + element.x/10 + ' ' + "0" + ' ' + element.y/10 + ','
				})
				return results
			}

			function drawAR() {
				socket.emit("drawAr", "This is drawAr")
			}

			function receivedDataFromSelect() {
				let dataShape = document.getElementById("shapeSelect")
				let shapeValue = dataShape.options[dataShape.selectedIndex].value
				let dataColor = document.getElementById("colorSelect")
				let colorValue = dataColor.options[dataColor.selectedIndex].value
				console.log('This is your value', {'shape': shapeValue, 'color': colorValue})
				if(shapeValue === 'sphere') {
					socket.emit('newShape',{geometry: "primitive: sphere; radius: 1000;",
		    	position:"0 1200 -3000",
		    	material:`color:${colorValue}; metalness:0.0; roughness:1.0;`,
		    	message:"new Object"})
				} else if  (shapeValue === 'box') {
					socket.emit('newShape',{geometry: "primitive: box;",
		    	position:"0 1200 -3000",
		    	material:`color:${colorValue}; metalness:0.0; roughness:1.0;`,
		    	message:"new Object"})
				} else if (shapeValue === 'cone') {
					socket.emit('newShape',{geometry: "primitive: cone;",
		    	position:"0 1200 -3000",
		    	material:`color:${colorValue}; metalness:0.0; roughness:1.0;`,
		    	message:"new Object"})
				} else if (shapeValue === 'torus-knot') {
					socket.emit('newShape',{geometry: "primitive: torus-knot;",
		    	position:"0 1200 -3000",
		    	material:`color:${colorValue}; metalness:0.0; roughness:1.0;`,
		    	message:"new Object"})
				}
				let entity = document.createElement('a-entity');
				entity.setAttribute("geometry", `primitive: ${shapeValue};`)
				entity.setAttribute("material", `color: ${colorValue};`)
				entity.setAttribute("position", '0 2 -1.877')
				document.querySelector('a-scene').appendChild(entity)
			}
	</script>
	<style type="text/css">
		.aframebox {
			height: 500px;
			width: 500px;
			}
	</style>
<body>
	<a-scene class="aframebox" embedded>
<!-- 		<a-box position="0 2 0" width="1" height="1" depth="1" color="blue"></a-box>
		<a-tube path="5 0 5, 5 0 -5, -5 0 -5" radius="0.5" material="color: red"></a-tube> -->
	</a-scene>
	<div>
		<h3>Please Select a Shape</h3>
			<p>Shape</p>
			<select id="shapeSelect">
			  <option value="box">Box</option>
			  <option value="sphere">Sphere</option>
			  <option value="cylinder">Cylinder</option>
			  <option value="torus">Torus</option>
			</select>
		<h3>Please Select a Color</h3>
			<p>Color</p>
			<select id="colorSelect">
			  <option value="blue">Blue</option>
			  <option value="red">Red</option>
			  <option value="yellow">Yellow</option>
			  <option value="green">Green</option>
			</select>
	</div>
	<button type="button" onclick="receivedDataFromSelect()">Send Object</button>
	<button type="button" onclick="goToAr2()">Change to Mixed Reality 2 View</button>
	<button type="button" onclick="test()">Howdy</button>
	<button type="button" onclick="createBox()">Create a box</button>
	<button type="button" onclick="goToAr2()">Ar2</button>
	<button type="button" onclick="drawAR()">Give me a object</button>
</body>
</html>